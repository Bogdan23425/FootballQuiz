# Project Log

2026-01-07 — добавление загрузочного экрана  
Запрос: добавить SplashActivity как новую точку входа перед MainActivity с автоматическим переходом через 2.5 секунды  
Сделано: создан SplashScreen.kt (UI загрузочного экрана), создан SplashActivity.kt (Activity с логикой перехода), изменен AndroidManifest.xml (перенесен LAUNCHER intent-filter на SplashActivity)  
Статус: ✅

2026-01-07 — получение ISO кода страны SIM-карты  
Запрос: реализовать функцию simCountryGeo для получения ISO кода страны SIM-карты через TelephonyManager в верхнем регистре или null  
Сделано: создан DeviceInfo.kt с функцией simCountryGeo, которая получает simCountryIso через TelephonyManager и возвращает значение в верхнем регистре или null  
Статус: ✅

2026-01-07 — сетевой запрос к серверу и сохранение результата  
Запрос: реализовать POST запрос к https://metricplay.click/api/app/ с полями bundle и country, сохранить полученный URL в SharedPreferences  
Сделано: создан ServerApi.kt с функцией fetchUrl для выполнения POST запроса (application/x-www-form-urlencoded), расширен AppPrefs функциями saveUrl и getUrl, интегрирован запрос в SplashActivity, добавлено разрешение INTERNET в AndroidManifest.xml  
Статус: ✅

2026-01-07 — исправление логики первого запуска  
Запрос: исправить логику задачи 3 - сетевой запрос должен выполняться только при первом запуске (если URL отсутствует в SharedPreferences)  
Сделано: добавлена проверка наличия URL в SharedPreferences перед выполнением запроса в SplashActivity, запрос выполняется только если сохраненного URL нет  
Статус: ✅

2026-01-07 — открытие URL через Custom Tabs и контроль возврата  
Запрос: реализовать открытие сохраненного URL через Chrome Custom Tabs в полноэкранном режиме, при наличии URL открывать Custom Tabs вместо MainActivity, при закрытии Custom Tabs автоматически открывать URL снова  
Сделано: добавлена зависимость androidx.browser:browser, создан CustomTabsHelper.kt для работы с Custom Tabs, изменена логика SplashActivity - проверка наличия URL и открытие либо Custom Tabs (если URL есть), либо MainActivity (если URL нет), реализовано зацикливание через onResume при закрытии Custom Tabs  
Статус: ✅

2026-01-07 — исправление реализации Custom Tabs  
Запрос: убрать задержку перед открытием Custom Tabs (открывать сразу при наличии URL), упростить CustomTabsHelper до минимальной реализации без UI-настроек  
Сделано: убрана задержка delay из ветки с Custom Tabs в SplashActivity (задержка оставлена только для ветки MainActivity), упрощен CustomTabsHelper - убраны все настройки UI (цвет, анимации, заголовок), оставлена только минимальная реализация Builder → build() → launchUrl()  
Статус: ✅

2026-01-07 — проверка при запуске приложения на SplashActivity  
Запрос: реализовать логику проверки SharedPreferences при каждом запуске - если URL есть открывать Custom Tabs сразу (без запроса), если URL нет выполнять POST-запрос и в зависимости от результата открывать либо Custom Tabs, либо MainActivity  
Сделано: логика в SplashActivity уже соответствует требованиям - при каждом запуске сначала проверяется SharedPreferences, при наличии URL сразу открывается Custom Tabs без сетевого запроса, при отсутствии URL выполняется POST-запрос, при успешном ответе URL сохраняется и открывается Custom Tabs, при ошибке или пустом ответе открывается MainActivity  
Статус: ✅

2026-01-07 — управление воспроизведением музыки
Запрос: музыка не должна играть при открытом Custom Tabs, музыка должна играть только при запуске MainActivity
Сделано: дополнительная логика не требуется — при наличии URL MainActivity не запускается, AudioManager не инициализируется, музыка не воспроизводится; при отсутствии URL запускается MainActivity и музыка играет
Статус: ✅

2026-01-07 — исправление пункта 1 ТЗ: добавление лоадера на загрузочный экран
Запрос: добавить индикатор загрузки (CircularProgressIndicator) на SplashScreen для соответствия пункту 1 ТЗ "Создать загрузочный экран с лоадером и фоном"
Сделано: добавлен CircularProgressIndicator в SplashScreen.kt после текста с отступом 16.dp, загрузочный экран теперь содержит фон (AppBackground), текст названия приложения и лоадер
Статус: ✅
